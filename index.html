<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Rate Monitor - Location Sender</title>
    <script>
        // Function to get the user's location and send it to the ESP32
        function getLocationAndSendData() {
            if (navigator.geolocation) {
                // Request the user's current position
                navigator.geolocation.getCurrentPosition(sendLocationData, showError);
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        // Function to send the location data to the ESP32
        function sendLocationData(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            const data = JSON.stringify({
                latitude: latitude,
                longitude: longitude
            });

            // Replace this URL with the IP address of your ESP32
            var url = "http://192.168.3.188/update"; // HTTP for local connection, not HTTPS

            var xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

            // Handle the response when data is sent
            xhr.onload = function () {
                if (xhr.status === 200) {
                    console.log("Data sent successfully");
                    alert("Location sent successfully!");
                } else {
                    console.error("Error sending data: " + xhr.status);
                    alert("Error sending location data.");
                }
            };

            xhr.onerror = function () {
                console.error("Request failed");
                alert("Request failed. Check your connection.");
            };

            // Send the data to the ESP32
            xhr.send(data);
        }

        // Function to handle errors in getting geolocation
        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    alert("User denied the request for Geolocation.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert("Location information is unavailable.");
                    break;
                case error.TIMEOUT:
                    alert("The request to get user location timed out.");
                    break;
                case error.UNKNOWN_ERROR:
                    alert("An unknown error occurred.");
                    break;
            }
        }

        // Call the function when the page is loaded
        window.onload = function () {
            // Automatically trigger location request after page loads
            getLocationAndSendData();
        };
    </script>
</head>
<body>
    <h1>Heart Rate Monitor</h1>
    <p>Sending location data to ESP32...</p>

    <p>Waiting for your location...</p>

    <button onclick="getLocationAndSendData()">Send Location Now</button>
</body>
</html>
